{% extends '@Admin/default/templateadmin.html.twig' %}
{% block section_haider %}
<section class="content-header">
      <h1>
        Répondres aux messages
        <small>Services 216</small>
      </h1>
      <ol class="breadcrumb">
      
        <li class="active"> <i class="fa fa-envelope"></i>  Messages</li>
      </ol>
    </section>
{%endblock%}





 {% block content %}




  <div class="row">
<div class="col-md-12">



<div class="box">
            <div class="box-header">
              <h3 class="box-title">Messages Reçues</h3><br/>
            




            </div>
            <!-- /.box-header -->
            <div class="box-body">
              <table id="tablemessagesadmin" class="table table-bordered table-striped" >
                <thead>
                <tr>
                 <th class="text-center">Nom</th>
                  <th class="text-center">Prénom</th>
                  <th class="text-center">Sujet</th>
                  <th class="text-center">Status</th>

                 <th class="text-center">Date</th>
                
                  <th class="text-center">Action</th>
                </tr>
                </thead>
                
              </table>
            </div>
            <!-- /.box-body -->
          </div>         























</div>
</div>







<div class="modal fade" tabindex="-1" id="modalvoirmessage" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">voir message</h4>
      </div>
      <div class="modal-body">
       <div class="containermessage">


       </div>
      </div>
     
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->







<div class="modal fade" tabindex="-1" id="modalrepondre" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Répondre au message</h4>
      </div>
      <div class="modal-body">
         <form method='post' action='{{path('repondre_message')}}' id='form-envoyer-admin'>
         <div class="row">
       <input type="hidden" id="idmessage" name="idmessage" />
       
        <div class="col-md-12 form-group">
                  <label for="username">Sujet :*</label>
                 

                  <input type="text" id="sujet_message" name="sujet_message" class="form-control">                
                    <span class="text-danger" id="sujet_message_eureur"></span>

                 
       </div>



        <div class="col-md-12 form-group">
                  <label for="username">Message :*</label>  
                   <textarea rows="5" id="message_admin" name="message_admin" class="form-control"></textarea>                
                    <span class="text-danger" id="message_admin_eureur"></span>

                 
       </div>












      </div>



   




      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" id="envoi-admin"><span>Envoyer</span><i id="spin-envoyer-admin"></i></button>
            </form>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->







































<style>

 #loadingvoir{
               text-align: center;
               background:url(' {{asset('uploads/loader.gif')}}') no-repeat center;
               height:150px;
                    } 
          
            </style>






  {% endblock %}
  {%block aside %}
  {% endblock %}

  {%block javascript%}
  <script>

    var messages;

  $(document).ready(function($){
 
 messages=$("#tablemessagesadmin").DataTable({
     columnDefs: [
    {
        targets: -1,
        className: 'dt-body-left'
    }
  ],
  'destroy':true,
   
    'ajax':'{{path('all_message_admin')}}',
     'order': []
});


});






function repondremessage(id)
{
  

  $("#idmessage").val(id);
}












$(document).on("submit", "#form-envoyer-admin", function(e){
 e.preventDefault();

$('#envoi-admin').prop('disabled',true);
$("#spin-envoyer-admin").addClass('fa fa-spinner fa-spin fa-register');

    var sujet=$('#sujet_message').val();
    var message=$('#message_admin').val();
  
 
  
     var errormArray=['sujet_message_eureur','message_admin_eureur'];
    





    
                    if(sujet=="")
                  {
                       document.getElementById('sujet_message_eureur').textContent='Ce champ ne doit pas etre vide ';
                     $("#spin-envoyer-admin").removeClass('fa fa-spinner fa-spin fa-register');
                          $('#envoi-admin').prop('disabled',false); 
                  }
                  

                    if(message=="")
                  {
                       document.getElementById('message_admin_eureur').textContent='Ce champ ne doit pas entre vide ';
                     $("#spin-envoyer-admin").removeClass('fa fa-spinner fa-spin fa-register');
                          $('#envoi-admin').prop('disabled',false); 
                  }


 















                   
                  

                 

              
                  

                








                        $('#sujet_message').change(function(){
                  
                 if($.trim(document.getElementById('sujet_message_eureur').textContent) !== "")

                                  {
                                    document.getElementById('sujet_message_eureur').textContent="";
                                  }
                    
                                 });


                                 $('#message_admin').change(function(){
                  
                 if($.trim(document.getElementById('message_admin_eureur').textContent) !== "")

                                  {
                                    document.getElementById('message_admin_eureur').textContent="";
                                  }
                    
                                 });


                    
           



                    


                   

          



                    






 var formmessage = document.getElementById("form-envoyer-admin");
if(sujet!=="" &&message!=="")
{

$.ajax({
 dataType:"json",
url:$("#form-envoyer-admin").attr('action'),
type:$("#form-envoyer-admin").attr('method'),
data:new FormData(formmessage),
contentType:false,
processData:false,
cache:false,
success:function(data,status,object){
  var msg=data.message;
  if(data.success==true){
     
    errormArray.forEach(function(error){
                                  if($.trim(document.getElementById(error).textContent) !== "")

                                  {
                                    document.getElementById(error).textContent="";
                                  }
                               });

       $("#spin-envoyer-admin").removeClass('fa fa-spinner fa-spin fa-register');
                          $('#envoi-admin').prop('disabled',false); 

       $('#modalrepondre').modal('hide');
      
      messages.ajax.reload(null,true);

       toastr.success(msg,'Success', {
                                      
                                      "closeButton": false,
                                       "debug": false,
                                        "newestOnTop": false,
                                        "progressBar": true,
                                        "maxOpened": 0,
                                        "positionClass": "toast-top-right",
                                         "preventDuplicates": false,
                                         "preventOpenDuplicates": false,
                                         "onclick": null,
                                          "showDuration": "300",
                                          "hideDuration": "1000",
                                           "timeOut": "5000",
                                           "extendedTimeOut": "1000",
                                           "showEasing": "swing",
                                           "hideEasing": "linear",
                                           "showMethod": "fadeIn",
                                        "hideMethod": "fadeOut"
                              


                               });





   
   
     
  }else{



              if(data.errors)
                            {
                              errormArray.forEach(function(error){

                               if($.trim(document.getElementById(error).textContent) !== "")

                                  {
                                    document.getElementById(error).textContent="";
                                  }

                              });

                              data.errors.forEach(function(error)
                              {

                               document.getElementById(error.elementId).textContent=error.errorMessage;
                              });









    toastr.error(msg,'Error', {
                                      
                                      "closeButton": false,
                                       "debug": false,
                                        "newestOnTop": false,
                                        "progressBar": true,
                                        "positionClass": "toast-top-right",
                                         "preventDuplicates": false,
                                         "onclick": null,
                                          "showDuration": "300",
                                          "hideDuration": "1000",
                                           "timeOut": "5000",
                                           "extendedTimeOut": "1000",
                                           "showEasing": "swing",
                                           "hideEasing": "linear",
                                           "showMethod": "fadeIn",
                                        "hideMethod": "fadeOut"
                              


                               });

  $("#spin-envoyer-admin").removeClass('fa fa-spinner fa-spin fa-register');
                          $('#envoi-admin').prop('disabled',false); 

  }
}


 $("#spin-envoyer-admin").removeClass('fa fa-spinner fa-spin fa-register');
                          $('#envoi-admin').prop('disabled',false); 


},
error:function()
{
 $("#spin-envoyer-admin").removeClass('fa fa-spinner fa-spin fa-register');
                          $('#envoi-admin').prop('disabled',false); 
}
});

}

});




















  </script>
<script>
function voirmessageadmin(id)
{
$('.containermessage').html('<div id="loadingvoir" style=""></div>');  
$.ajax({
 dataType:"json",
url:'/voir-message-admin',
type:'POST',
data:{id:id},
success:function(data,status,object){
  
 
    $('.containermessage').html(data.output);
  

}

});

}


</script>

  {% endblock %}